import{j as r}from"./jsx-runtime.ojTTAiD7.js";import{a as v}from"./_astro_actions.DCLOYqNE.js";import{r as n}from"./index.Dck49-wq.js";import{E as d}from"./ErrorMessageForm.Ct9yi1Us.js";const R=()=>{const[l,y]=n.useState([]),[h,p]=n.useState(null),[c,m]=n.useState({fechaRutina:"",diaSemana:"",actividad:"",kilometrajeRecorrido:""}),[o,x]=n.useState({}),g=async()=>{const s=(e=>{const i=`; ${document.cookie}`.split(`; ${e}=`);if(i.length===2)return i.pop()?.split(";").shift()})("jwtToken");console.log("El token es ",s);try{const e=await fetch("http://localhost:8080/rutinaUsuario/get",{method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Authorization:`Bearer ${s?.trim()}`}});if(!e.ok)throw console.error("Error fetching all routines:",e),new Error("Error fetching all routines");const a=await e.json();y(a)}catch(e){console.error("Error fetching all routines:",e)}};n.useEffect(()=>{g()},[]),n.useEffect(()=>{l.length===6&&alert("The routine of the week is complete, this model will be used to make calculations and recommendations for electric vehicles.")},[l]),n.useEffect(()=>{l.length===7?p("The routine of the week is complete, this model will be used to make calculations and recommendations for electric vehicles."):p(null)},[l]);const u=t=>{const{name:s,value:e}=t.target;m({...c,[s]:e})},j=async t=>{t.preventDefault(),x({});const s=new FormData(t.currentTarget);let e=await v.userRoutine(s);if(e.data&&typeof e.data=="object"&&"success"in e.data&&(e=e.data),e.success!==void 0&&!e.success||e.error){console.error(e.error);const a={};if(e.error&&"fields"in e.error&&(e.error.fields.general&&(a.general=e.error.fields.general),Object.entries(e.error.fields).forEach(([i,f])=>{i!=="general"&&(a[i]=f)})),e.error?.fields?.general)a.general=e.error.fields.general;else if(typeof e.error=="object"){const i=await e.error.fields.general;i&&(a.general=i)}e.data&&typeof e.data=="object"&&"error"in e.data&&e.data.error&&typeof e.data.error=="object"&&"fields"in e.data.error&&Object.entries(e.data.error.fields).forEach(([i,f])=>{a[i]=f}),console.error(a),x(a);return}m({fechaRutina:"",diaSemana:"",actividad:"",kilometrajeRecorrido:""}),g()};return r.jsxs("div",{className:"flex flex-col items-center w-full space-y-8 gap-6",children:[h&&r.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:r.jsx("span",{className:"block sm:inline",children:h})}),r.jsxs("form",{className:"space-y-6 w-3/5",onSubmit:j,children:[r.jsxs("div",{className:"rounded-md shadow-sm space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"fechaRutina",className:"block text-sm font-medium text-gray-700",children:"Routine Date"}),r.jsx("input",{id:"fechaRutina",name:"fechaRutina",type:"date",required:!0,value:c.fechaRutina,onChange:t=>{u(t);const s=new Date(t.target.value),e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];m(a=>({...a,fechaRutina:t.target.value,diaSemana:e[s.getUTCDay()]}))},className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:z-10 sm:text-sm"}),o.fechaRutina&&r.jsx(d,{errorMessage:o.fechaRutina})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"diaSemana",className:"block text-sm font-medium text-gray-700",children:"Day of the Week"}),r.jsx("input",{id:"diaSemana",name:"diaSemana",type:"text",readOnly:!0,value:c.diaSemana,className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:z-10 sm:text-sm"}),o.diaSemana&&r.jsx(d,{errorMessage:o.diaSemana})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"actividad",className:"block text-sm font-medium text-gray-700",children:"Activity"}),r.jsx("input",{id:"actividad",name:"actividad",type:"text",required:!0,value:c.actividad,onChange:u,className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:z-10 sm:text-sm",placeholder:"Activity"}),o.actividad&&r.jsx(d,{errorMessage:o.actividad})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kilometrajeRecorrido",className:"block text-sm font-medium text-gray-700",children:"Traveled Kilometers"}),r.jsx("input",{id:"kilometrajeRecorrido",name:"kilometrajeRecorrido",type:"text",required:!0,value:c.kilometrajeRecorrido,onChange:u,className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:z-10 sm:text-sm",placeholder:"Traveled Kilometers"}),o.kilometrajeRecorrido&&r.jsx(d,{errorMessage:o.kilometrajeRecorrido})]})]}),o.general&&r.jsx(d,{errorMessage:o.general}),r.jsx("div",{children:r.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Register Routine"})})]}),r.jsx("div",{className:"bg-gray-50 rounded-lg overflow-auto",children:l.length===0?r.jsx("p",{className:"text-gray-500 px-60",children:"No routines registered."}):r.jsxs("table",{className:"min-w-full min-h-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-[#0891b2] hover:bg-cyan-500",children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Day of the Week"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Activity"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Traveled Kilometers"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map((t,s)=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.diaSemana}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.actividad}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:t.kilometrajeRecorrido})]},s))})]})})]})};export{R as default};
